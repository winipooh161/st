1751646096s:11402:"<!DOCTYPE html>
<html lang="ru">
<head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="referrer" content="same-origin"> <meta name="content-type" content="text/html; charset=UTF-8"> <!-- Предзагрузка критических ресурсов --> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link rel="dns-prefetch" href="https://fonts.googleapis.com"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; contain: layout style paint; } img { max-width: 100%; height: auto; content-visibility: auto; loading: lazy; will-change: transform; } /* Оптимизация CSS рендеринга */ .editable-element { will-change: contents; transform: translateZ(0); } /* Скрываем скроллбары */ ::-webkit-scrollbar { width: 0px; background: transparent; } /* Убираем выделение */ * { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } </style>
</head>
<body data-instant-allow-query-string><?php // Получаем параметры серии $is_series = isset($_GET['is_series']) && ($_GET['is_series'] === '1' || $_GET['is_series'] === 'true'); $series_max = isset($_GET['series_max']) ? intval($_GET['series_max']) : 0; $series_current = isset($_GET['series_current']) ? intval($_GET['series_current']) : 0; // Определяем, нужно ли показывать блок серии $show_series_block = $is_series && $series_max > 0; $current_url = isset($_SERVER['REQUEST_URI']) ? $_SERVER['REQUEST_URI'] : ''; $is_user_template_page = strpos($current_url, '/user-templates/') !== false; // Создаем переменную для отображения или скрытия блока серии $series_block_display = ($show_series_block && $is_user_template_page) ? 'block' : 'none'; $series_remaining = $series_max - $series_current; $series_percentage = $series_max > 0 ? ($series_current / $series_max) * 100 : 0; // Для отладки выводим параметры в комментариях echo "<!-- Параметры серии: is_series=" . ($is_series ? 'true' : 'false') . ", series_max=" . $series_max . ", series_current=" . $series_current . " -->\n"; echo "<!-- URL и статус блока серии: url=" . $current_url . ", is_user_template_page=" . ($is_user_template_page ? 'true' : 'false') . ", show_series_block=" . ($show_series_block ? 'true' : 'false') . " -->\n"; ?> <!DOCTYPE html> <html lang="ru"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Тестовый редактируемый шаблон</title> <style> body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; } .header { text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; border-radius: 10px; margin-bottom: 30px; } .content-section { margin-bottom: 30px; } .feature-box { border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; background: #f9f9f9; } .cta-button { display: inline-block; background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; text-align: center; } .footer { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; } img { max-width: 100%; height: auto; border-radius: 8px; } /* Стили для блока информации о серии */ .series-info-block { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin: 20px 0; display: none; } .series-info-block .progress { height: 8px; background-color: #e9ecef; border-radius: 4px; margin: 10px 0; overflow: hidden; } .series-info-block .progress-bar { background-color: #28a745; height: 100%; transition: width 0.3s ease; } .series-info-block .series-stats { display: flex; justify-content: space-between; font-size: 0.9em; color: #6c757d; } .series-badge { display: inline-block; background-color: #198754; color: white; font-size: 0.8rem; padding: 0.2rem 0.5rem; border-radius: 0.25rem; margin-bottom: 10px; } </style> </head> <body> <div class="header"> <h1 data-editable="main_title" data-field-name="Главный заголовок" data-field-type="text">Добро пожаловать!</h1> <p data-editable="header_subtitle" data-field-name="Подзаголовок" data-field-type="text">Это ваш новый удивительный проект</p> </div> <div class="content-section"> <img data-editable="hero_image" data-field-name="Главное изображение" data-field-type="image" src="https://via.placeholder.com/800x400/667eea/ffffff?text=Ваше+изображение" alt="Главное изображение"> </div> <div class="content-section"> <h2 data-editable="section_title" data-field-name="Заголовок секции" data-field-type="text">О нашем проекте</h2> <p data-editable="description_text" data-field-name="Описание проекта" data-field-type="textarea"> Здесь вы можете рассказать о своем проекте, его особенностях и преимуществах. Этот текст можно легко изменить через редактор. </p> </div> <div class="content-section" style="text-align: center;"> <a href="#" data-editable="cta_link" data-field-name="Призыв к действию" data-field-type="link" class="cta-button"> <span data-editable="cta_text" data-field-name="Текст кнопки" data-field-type="text">Начать сейчас</span> </a> </div> <div class="footer"> <p data-editable="footer_text" data-field-name="Текст в подвале" data-field-type="text"> © 2025 Ваша компания. Все права защищены. </p> <p> Контакты: <a href="mailto:info@example.com" data-editable="contact_email" data-field-name="Email для связи" data-field-type="email">info@example.com</a> | <a href="tel:+7999999999" data-editable="contact_phone" data-field-name="Телефон" data-field-type="tel">+7 (999) 999-99-99</a> </p> </div> <!-- Блок информации о серии шаблонов --> <div id="seriesInfoBlock" class="series-info-block" style="display: <?php echo $series_block_display; ?>"> <?php if ($is_series && $series_max > 0): ?> <div class="series-badge">Серия</div> <h4 class="series-title">Информация о серии</h4> <div class="progress"> <div class="progress-bar" role="progressbar" style="width: <?php echo $series_percentage; ?>%"></div> </div> <div class="series-stats"> <span class="remaining-count">Осталось: <?php echo $series_remaining; ?></span> <span class="total-count">Всего в серии: <?php echo $series_max; ?></span> </div> <?php endif; ?> </div> <!-- Скрипт для обработки информации о серии --> <script> document.addEventListener('DOMContentLoaded', function() { if (window.parent) { try { console.log('Отправка сообщения о готовности шаблона'); window.parent.postMessage(JSON.stringify({ action: 'templateReady', seriesData: { is_series: <?php echo $is_series ? 'true' : 'false'; ?>, max: <?php echo $series_max; ?>, current: <?php echo $series_current; ?>, remaining: <?php echo $series_remaining; ?> } }), '*'); } catch (e) { console.error('Ошибка отправки сообщения родительскому окну:', e); } } window.addEventListener('message', function(event) { try { const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data; console.log('Получено сообщение от родительского окна:', data); if (data.action === 'updateSeriesInfo' && data.seriesData) { console.log('Получены новые данные о серии из родительского окна:', data.seriesData); const seriesBlock = document.getElementById('seriesInfoBlock'); if (seriesBlock) { seriesBlock.style.display = 'block'; } } } catch (e) { console.error('Ошибка обработки сообщения:', e); } }); }); </script> <!-- Дополнительные настройки для оптимизации --> <script> const templateMode = "editor"; document.addEventListener("DOMContentLoaded", function() { document.body.setAttribute("data-loaded", "true"); const editorMode = document.querySelector(".series-editor-mode"); const publicMode = document.querySelector(".series-public-mode"); if (editorMode && publicMode) { if (templateMode === "editor") { editorMode.style.display = "block"; publicMode.style.display = "none"; } else { editorMode.style.display = "none"; publicMode.style.display = "block"; } } }); document.addEventListener("contextmenu", e => e.preventDefault()); document.addEventListener("selectstart", e => e.preventDefault()); document.documentElement.style.scrollBehavior = "smooth"; document.addEventListener("wheel", e => { if (e.ctrlKey) e.preventDefault(); }, { passive: false }); window.addEventListener("load", () => { const images = document.querySelectorAll("img"); if (images.length > 0) { images.forEach(img => { if (!img.loading) img.loading = "eager"; if (img.dataset.src) { const imgPreload = new Image(); imgPreload.src = img.dataset.src; } }); } }); </script> </body> </html> <script> // Режим отображения шаблона const templateMode = "editor"; // Ускоряем инициализацию document.addEventListener("DOMContentLoaded", function() { // Помечаем элементы как загруженные для быстрого отображения document.body.setAttribute("data-loaded", "true"); // Устанавливаем режим отображения для серии шаблонов const editorMode = document.querySelector(".series-editor-mode"); const publicMode = document.querySelector(".series-public-mode"); if (editorMode && publicMode) { if (templateMode === "editor") { editorMode.style.display = "block"; publicMode.style.display = "none"; } else { editorMode.style.display = "none"; publicMode.style.display = "block"; } } }); // Отключаем контекстное меню document.addEventListener("contextmenu", e => e.preventDefault()); // Отключаем выделение текста document.addEventListener("selectstart", e => e.preventDefault()); // Оптимизация для плавной прокрутки document.documentElement.style.scrollBehavior = "smooth"; // Принудительное отключение масштабирования document.addEventListener("wheel", e => { if (e.ctrlKey) e.preventDefault(); }, { passive: false }); // Предзагрузка изображений window.addEventListener("load", () => { const images = document.querySelectorAll("img"); if (images.length > 0) { images.forEach(img => { if (!img.loading) img.loading = "eager"; if (img.dataset.src) { const imgPreload = new Image(); imgPreload.src = img.dataset.src; } }); } }); </script>
</body>
</html>";
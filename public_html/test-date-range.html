<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç</title>
    <meta name="csrf-token" content="test-token">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .template-content {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .date-range {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .date-item {
            flex: 1;
        }
        .date-item strong {
            display: block;
            margin-bottom: 8px;
            color: #333;
        }
        [data-editable] {
            display: inline-block;
            padding: 8px 12px;
            background-color: #fff;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        [data-editable]:hover {
            background-color: #f8f9fa;
            border-color: #007bff;
        }
        [data-editable="start_date"], [data-editable="end_date"] {
            background-color: #e7f3ff;
            border-color: #007bff;
        }
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .controls button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #0056b3;
        }
        .debug-info {
            background: #333;
            color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .debug-info h3 {
            margin-top: 0;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="collectAndDisplayData()">–°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="simulateSave()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
        <button onclick="clearDebugInfo()">–û—á–∏—Å—Ç–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É</button>
    </div>

    <div class="template-content" id="template-content">
        <h1>–¢–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –¥–∞—Ç</h1>
        
        <div class="date-range">
            <div class="date-item">
                <strong>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</strong>
                <span data-editable="start_date" data-field-name="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞" data-field-type="date" data-date-format="dd.mm.yyyy">01.01.2025</span>
            </div>
            <div class="date-item">
                <strong>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong>
                <span data-editable="end_date" data-field-name="–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è" data-field-type="date" data-date-format="dd.mm.yyyy">31.12.2025</span>
            </div>
        </div>

        <div class="content-section">
            <h2 data-editable="company_name" data-field-name="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏" data-field-type="text">–û–û–û "–¢–µ—Å—Ç–æ–≤–∞—è –ö–æ–º–ø–∞–Ω–∏—è"</h2>
            <p data-editable="description" data-field-name="–û–ø–∏—Å–∞–Ω–∏–µ" data-field-type="text">
                –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç.
            </p>
        </div>
    </div>

    <div class="debug-info" id="debug-info">
        <h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <div>–ù–∞–∂–º–∏—Ç–µ "–°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ" –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</div>
    </div>

    <script>
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.baseTemplateId = 1;
        window.storeUrl = '/test-store';
        window.myTemplatesUrl = '/my-templates';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function collectAndDisplayData() {
            if (typeof window.TemplateDataCollector === 'undefined') {
                updateDebugInfo('‚ùå TemplateDataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            try {
                const data = window.TemplateDataCollector.collectData();
                updateDebugInfo('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω—ã:\n' + JSON.stringify(data, null, 2));
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –¥–∞—Ç
                if (data.dateRange) {
                    updateDebugInfo('\nüóìÔ∏è –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç:\n' + 
                        `- date_from: ${data.dateRange.date_from}\n` +
                        `- date_to: ${data.dateRange.date_to}\n`);
                }
            } catch (error) {
                updateDebugInfo('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function simulateSave() {
            if (typeof window.saveTemplateData === 'function') {
                updateDebugInfo('üîÑ –°–∏–º—É–ª–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...');
                
                // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º fetch –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
                const originalFetch = window.fetch;
                window.fetch = function(url, options) {
                    updateDebugInfo('\nüì° –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä:\n' + 
                        `URL: ${url}\n` +
                        `Method: ${options.method}\n` +
                        `Headers: ${JSON.stringify(options.headers, null, 2)}\n` +
                        `Body: ${options.body}\n`);
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                    return Promise.resolve({
                        ok: true,
                        json: () => Promise.resolve({
                            success: true,
                            message: '–¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω',
                            redirect_url: '/my-templates'
                        })
                    });
                };
                
                // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                window.saveTemplateData();
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π fetch —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    window.fetch = originalFetch;
                }, 1000);
            } else {
                updateDebugInfo('‚ùå –§—É–Ω–∫—Ü–∏—è saveTemplateData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function clearDebugInfo() {
            document.getElementById('debug-info').innerHTML = '<h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3><div>–û—á–∏—â–µ–Ω–æ...</div>';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML = '<h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3><div>' + message + '</div>';
        }
        
        // –î–µ–ª–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç
        document.addEventListener('DOMContentLoaded', function() {
            const dateElements = document.querySelectorAll('[data-field-type="date"]');
            dateElements.forEach(element => {
                element.addEventListener('click', function() {
                    const currentDate = this.textContent;
                    const newDate = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É (–≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥–≥–≥):', currentDate);
                    if (newDate) {
                        this.textContent = newDate;
                        updateDebugInfo('üóìÔ∏è –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ' + newDate);
                    }
                });
            });
        });
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç -->
    <script src="/js/templates/template-data-collector.js"></script>
</body>
</html>

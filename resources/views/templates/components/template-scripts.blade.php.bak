{{-- –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–∏–∏ --}}
@include('templates.components.series-modal')

{{-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ --}}
<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/l10n/ru.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.css">

{{-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–∏ —Å—Ç–∏–ª–∏ --}}
<link rel="stylesheet" href="/css/templates/date-picker-enhanced.css">
<link rel="stylesheet" href="/css/templates/simple-calendar.css">

{{-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã --}}
<script src="/js/templates/template-editor.js"></script>
<script src="/js/templates/template-data-collector.js"></script>
<script src="/js/templates/inline-editor.js"></script>

<script>
    // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è JavaScript - –∏—Å–ø–æ–ª—å–∑—É–µ–º window –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    if (typeof window.editableElementsJson === 'undefined') {
        window.editableElementsJson = @json($baseTemplate->editable_elements ?? []);
    }
    if (typeof window.baseTemplateId === 'undefined') {
        window.baseTemplateId = {{ $baseTemplate->id ?? 'null' }};
    }
    if (typeof window.removeUrl === 'undefined') {
        window.removeUrl = '{{ route("templates.remove-cover") }}';
    }
    if (typeof window.previewUrl === 'undefined') {
        window.previewUrl = '{{ route('templates.preview', $baseTemplate->id ?? 0) }}';
    }
    if (typeof window.storeUrl === 'undefined') {
        window.storeUrl = '{{ route("user-templates.store") }}';
    }
    if (typeof window.myTemplatesUrl === 'undefined') {
        window.myTemplatesUrl = '{{ route("my-templates") }}';
    }
    
    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫ –∫–Ω–æ–ø–∫–∞–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–∫–∞–∫ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞, —Ç–∞–∫ –∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏)
    document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã
        if (typeof window.saveTemplateData === 'function') {
            console.log('‚úÖ –§—É–Ω–∫—Ü–∏—è saveTemplateData –¥–æ—Å—Ç—É–ø–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ');
        } else {
            console.error('‚ùå –§—É–Ω–∫—Ü–∏—è saveTemplateData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        }
        
        if (window.TemplateEditor) {
            console.log('‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞–π–¥–µ–Ω');
        } else {
            console.error('‚ùå –†–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
        
        if (window.TemplateDataCollector) {
            console.log('‚úÖ –°–±–æ—Ä—â–∏–∫ –¥–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞–π–¥–µ–Ω');
            console.log('‚úÖ –°–±–æ—Ä—â–∏–∫ –¥–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        } else {
            console.error('‚ùå –°–±–æ—Ä—â–∏–∫ –¥–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const saveMediaBtn = document.getElementById('save-media-btn');
        if (saveMediaBtn) {
            console.log('‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ save-media-btn –≤ –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
            saveMediaBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('üîÑ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏');
                if (window.saveTemplateData) {
                    window.saveTemplateData();
                } else {
                    console.error('–§—É–Ω–∫—Ü–∏—è saveTemplateData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            });
        } else {
            console.log('‚ùå –ö–Ω–æ–ø–∫–∞ save-media-btn –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—ã—á–Ω–æ–π –∫–Ω–æ–ø–∫–∏ (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)
        const saveTemplateBtn = document.getElementById('save-template-btn');
        if (saveTemplateBtn) {
            console.log('‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ save-template-btn, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
            saveTemplateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (window.saveTemplateData) {
                    window.saveTemplateData();
                } else {
                    console.error('–§—É–Ω–∫—Ü–∏—è saveTemplateData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            });
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
        window.addEventListener('beforeunload', function(e) {
            if (window.TemplateEditor && window.TemplateEditor.hasUnsavedChanges && window.TemplateEditor.hasUnsavedChanges()) {
                e.preventDefault();
                e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
            }
        });
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ saveTemplateData
    if (!window.saveTemplateData) {
        console.error('‚ùå –§—É–Ω–∫—Ü–∏—è saveTemplateData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç template-data-collector.js –ø–æ–¥–∫–ª—é—á–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
    } else {
        console.log('‚úÖ –§—É–Ω–∫—Ü–∏—è saveTemplateData –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
    }
</script>
